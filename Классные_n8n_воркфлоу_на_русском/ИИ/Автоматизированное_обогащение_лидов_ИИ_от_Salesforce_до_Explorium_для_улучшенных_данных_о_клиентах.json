{
  "id": "u92uqa8glb0TuCG9",
  "meta": {
    "instanceId": "0a70652f43c1b29dd16c35b61a38fd31c8004f58bc7e723bf43262a797407c77",
    "templateCredsSetupCompleted": true
  },
  "name": "Этот рабочий процесс n8n упрощает процесс обогащения информации о лидах, автоматически обнаруживая новые лиды, созданные в Salesforce, обрабатывая их с помощью инструментов на базе ИИ от Explorium и обновляя те же лиды в Salesforce с улучшенными данными о потенциальных клиентах.",
  "tags": [],
  "nodes": [
    {
      "id": "70a40c85-eb5d-41b0-96ab-11ba442189c8",
      "name": "Salesforce Trigger",
      "type": "n8n-nodes-base.salesforceTrigger",
      "position": [
        -1880,
        680
      ],
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "leadCreated"
      },
      "credentials": {
        "salesforceOAuth2Api": {
          "id": "unhmsSbB64eNwCMO",
          "name": "Salesforce account"
        }
      },
      "typeVersion": 1
    },
    {
      "id": "b16d1538-753a-405f-884c-c05dd1076c15",
      "name": "Update Lead",
      "type": "n8n-nodes-base.salesforce",
      "position": [
        -340,
        680
      ],
      "parameters": {
        "leadId": "={{ $('Salesforce Trigger').item.json.Id}}",
        "operation": "update",
        "updateFields": {
          "city": "={{ $json.city || null }}",
          "email": "={{ $json.professions_email || null }}",
          "phone": "={{ $json.phone_numbers?.[0]?.phone_number || \"null\" }}\n",
          "state": "={{ $json.region_name || '' }}",
          "title": "={{ $json.experience?.[0]?.title?.name || null }}",
          "company": "={{ $json.company_name || null }}",
          "country": "={{ $json.country_name || null }}",
          "website": "={{ $json.experience?.[0]?.company?.website || null }}",
          "mobilePhone": "={{ $json.mobile_phone }}"
        }
      },
      "credentials": {
        "salesforceOAuth2Api": {
          "id": "unhmsSbB64eNwCMO",
          "name": "Salesforce account"
        }
      },
      "typeVersion": 1
    },
    {
      "id": "5417925f-919e-4c44-ba21-9249cab895eb",
      "name": "Match_prospect",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        -1660,
        680
      ],
      "parameters": {
        "url": "https://api.explorium.ai/v1/prospects/match",
        "method": "POST",
        "options": {},
        "jsonBody": "={\n  \"prospects_to_match\": [\n    {\n      \"full_name\": \"{{ $('Salesforce Trigger').item.json.FirstName }} {{ $('Salesforce Trigger').item.json.LastName }}\",\n      \"company_name\": \"{{ $('Salesforce Trigger').item.json.Company }}\"\n    }\n  ]\n}",
        "sendBody": true,
        "jsonHeaders": "{\n  \"Content-Type\": \"application/json\",\n  \"Accept\": \"application/json\"\n}",
        "sendHeaders": true,
        "specifyBody": "json",
        "authentication": "genericCredentialType",
        "specifyHeaders": "json",
        "genericAuthType": "httpHeaderAuth"
      },
      "credentials": {
        "httpHeaderAuth": {
          "id": "85mkGmNNdK1951hF",
          "name": "Header Auth Connection"
        }
      },
      "typeVersion": 4.2
    },
    {
      "id": "360ca1d3-c1e6-46f4-b190-ddf76ed8847b",
      "name": "Extract Prospect IDs from Matched Results",
      "type": "n8n-nodes-base.code",
      "position": [
        -1220,
        680
      ],
      "parameters": {
        "jsCode": "const allItems = $input.all();\nconst prospectIds = allItems.map(item => \n  item.json.matched_prospects.map(prospect => prospect.prospect_id)\n).flat();\n\nreturn [{\n  json: {\n    prospect_ids: prospectIds\n  }\n}];"
      },
      "typeVersion": 2
    },
    {
      "id": "aa419a45-dae1-47b0-8030-5fe0e193f804",
      "name": "Explorium Enrich Contacts Information",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        -1000,
        580
      ],
      "parameters": {
        "url": "https://api.explorium.ai/v1/prospects/contacts_information/bulk_enrich",
        "method": "POST",
        "options": {},
        "jsonBody": "={{ { \"prospect_ids\": $json.prospect_ids } }}",
        "sendBody": true,
        "jsonHeaders": "{\n  \"Content-Type\": \"application/json\",\n  \"Accept\": \"application/json\"\n}",
        "sendHeaders": true,
        "specifyBody": "=json",
        "authentication": "genericCredentialType",
        "bodyParameters": {
          "parameters": [
            {}
          ]
        },
        "specifyHeaders": "json",
        "genericAuthType": "httpHeaderAuth"
      },
      "credentials": {
        "httpHeaderAuth": {
          "id": "85mkGmNNdK1951hF",
          "name": "Header Auth Connection"
        }
      },
      "typeVersion": 4.2
    },
    {
      "id": "91bfa198-cecf-406f-94d8-1433a75e0ada",
      "name": "Merge",
      "type": "n8n-nodes-base.merge",
      "position": [
        -780,
        680
      ],
      "parameters": {
        "mode": "combine",
        "options": {},
        "fieldsToMatchString": "data[0].prospect_id"
      },
      "typeVersion": 3.1
    },
    {
      "id": "7d7866ec-8839-48c4-9dd7-239844dfb207",
      "name": "Filter non-matched",
      "type": "n8n-nodes-base.filter",
      "position": [
        -1440,
        680
      ],
      "parameters": {
        "options": {},
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "6896e951-8d66-41b1-87a5-a96d2e049675",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              },
              "leftValue": "={{ $json.matched_prospects.some(prospect => prospect.prospect_id !== null).toBoolean() }}",
              "rightValue": "null"
            }
          ]
        }
      },
      "typeVersion": 2.2
    },
    {
      "id": "b67d5f83-2ba9-4c78-84ff-0a94382788f8",
      "name": "Code - flatten",
      "type": "n8n-nodes-base.code",
      "position": [
        -560,
        680
      ],
      "parameters": {
        "jsCode": "return $input.all().map(item => \n    item.json.data.map(prospect => ({\n      prospect_id: prospect.prospect_id,\n      ...prospect.data\n    }))\n  ).flat()"
      },
      "typeVersion": 2
    },
    {
      "id": "96abf132-7d7e-4e91-89da-5f0b373385a9",
      "name": "Explorium Enrich Profiles",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        -1000,
        780
      ],
      "parameters": {
        "url": "https://api.explorium.ai/v1/prospects/profiles/bulk_enrich",
        "method": "POST",
        "options": {},
        "jsonBody": "={{ { \"prospect_ids\": $json.prospect_ids } }}",
        "sendBody": true,
        "jsonHeaders": "{\n  \"Content-Type\": \"application/json\",\n  \"Accept\": \"application/json\"\n}",
        "sendHeaders": true,
        "specifyBody": "=json",
        "authentication": "genericCredentialType",
        "bodyParameters": {
          "parameters": [
            {}
          ]
        },
        "specifyHeaders": "json",
        "genericAuthType": "httpHeaderAuth"
      },
      "credentials": {
        "httpHeaderAuth": {
          "id": "85mkGmNNdK1951hF",
          "name": "Header Auth Connection"
        }
      },
      "typeVersion": 4.2
    },
    {
      "id": "6c17ea6e-165f-407a-b4c9-8731d44243f8",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -2760,
        480
      ],
      "parameters": {
        "width": 760,
        "height": 2720,
        "content": "# Автоматически обогащайте лиды в Salesforce с помощью Explorium MCP"
      },
      "typeVersion": 1
    }
  ],
  "active": false,
  "pinData": {
    "Salesforce Trigger": [
      {
        "json": {
          "Id": "00QQJ00000I7no12AB",
          "City": null,
          "Email": "vincent.marinelli@flushingsavings.com",
          "Status": "New",
          "Street": null,
          "Company": "flushingsavings",
          "LastName": "marinelli",
          "FirstName": "vincent",
          "PostalCode": null,
          "attributes": {
            "url": "/services/data/v59.0/sobjects/Lead/00QQJ00000I7no12AB",
            "type": "Lead"
          }
        }
      }
    ]
  },
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "c8a79ca0-36ce-443f-b6fc-21bfa6ade38c",
  "connections": {
    "Merge": {
      "main": [
        [
          {
            "node": "Code - flatten",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Lead": {
      "main": [
        []
      ]
    },
    "Code - flatten": {
      "main": [
        [
          {
            "node": "Update Lead",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Match_prospect": {
      "main": [
        [
          {
            "node": "Filter non-matched",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter non-matched": {
      "main": [
        [
          {
            "node": "Extract Prospect IDs from Matched Results",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Salesforce Trigger": {
      "main": [
        [
          {
            "node": "Match_prospect",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Explorium Enrich Profiles": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Explorium Enrich Contacts Information": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Prospect IDs from Matched Results": {
      "main": [
        [
          {
            "node": "Explorium Enrich Contacts Information",
            "type": "main",
            "index": 0
          },
          {
            "node": "Explorium Enrich Profiles",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  }
}